<!-- candidates-page.component.html -->
<div class="candidates-page">
  <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
  <div class="page-header">
    <div class="header-content">
      <h1>Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†</h1>
      <button class="btn btn-primary" (click)="createCandidate()">
        + Ù…Ø±Ø´Ø­ Ø¬Ø¯ÙŠØ¯
      </button>
    </div>
  </div>

  <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ getTotalCandidates() }}</h3>
        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†</p>
      </div>
      <div class="stat-icon">ğŸ‘¥</div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ getTotalVotes() }}</h3>
        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆØ§Øª</p>
      </div>
      <div class="stat-icon">ğŸ—³ï¸</div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ getLeadingCandidate()?.votesCount || 0 }}</h3>
        <p>Ø£Ø¹Ù„Ù‰ ØªØµÙˆÙŠØª</p>
        <small *ngIf="getLeadingCandidate()">{{ getLeadingCandidate()?.fullName }}</small>
      </div>
      <div class="stat-icon">ğŸ‘‘</div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
  <div class="filters-section">
    <div class="search-container">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (input)="onSearchChange()"
        placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†..."
        class="search-input">
    </div>
    <select 
      [(ngModel)]="electionFilter" 
      (change)="onElectionFilterChange()"
      class="filter-select">
      <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª</option>
      <option *ngFor="let election of elections" [value]="election.id">
        {{ election.title }}
      </option>
    </select>
  </div>

  <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
  @if (errorMessage) {
    <div class="error-message">
      <p>{{ errorMessage }}</p>
      <button class="btn btn-retry" (click)="retryLoading()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
    </div>
  }

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† -->
  <div class="table-section">
    @if (isLoading) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
      </div>
    } @else if (filteredCandidates.length === 0 && !errorMessage) {
      <div class="empty-state">
        <div class="empty-icon">ğŸ‘¥</div>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø´Ø­ÙŠÙ†</h3>
        <p>Ù„Ù… Ù†Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø±Ø´Ø­ÙŠÙ† ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ</p>
        <button class="btn btn-primary" (click)="createCandidate()">
          Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø´Ø­ Ø¬Ø¯ÙŠØ¯
        </button>
      </div>
    } @else {
      <div class="table-container">
        <table class="candidates-table">
          <thead>
            <tr>
              <th>Ø§Ù„ØµÙˆØ±Ø©</th>
              <th>Ø§Ù„Ù…Ø±Ø´Ø­</th>
              <th>Ø§Ù„Ø­Ø²Ø¨</th>
              <th>Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨</th>
              <th>Ø§Ù„Ø£ØµÙˆØ§Øª</th>
              <th>Ø§Ù„Ù†Ø³Ø¨Ø©</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody>
            @for (candidate of filteredCandidates; track candidate.candidateId) {
              <tr>
                <td>
                  <div class="candidate-photo">
                    <img 
                      [src]="candidate.photoUrl || 'assets/images/default-avatar.png'" 
                      [alt]="candidate.fullName" 
                      class="photo"
                      (error)="candidate.photoUrl = 'assets/images/default-avatar.png'">
                  </div>
                </td>
                <td>
                  <div class="candidate-info">
                    <strong>{{ candidate.fullName }}</strong>
                    @if (candidate.biography) {
                      <p>{{ candidate.biography }}</p>
                    }
                  </div>
                </td>
                <td>
                  <span class="party-badge">{{ candidate.party || 'Ù…Ø³ØªÙ‚Ù„' }}</span>
                </td>
                <td>
                  <span class="election-name">{{ candidate.electionTitle }}</span>
                </td>
                <td>
                  <span class="count">{{ candidate.votesCount || 0 }}</span>
                </td>
                <td>
                  <div class="percentage-bar">
                    <div class="bar-container">
                      <div 
                        class="bar-fill" 
                        [style.width.%]="getVotesPercentage(candidate)">
                      </div>
                    </div>
                    <span class="percentage-text">{{ getVotesPercentage(candidate) | number:'1.1-1' }}%</span>
                  </div>
                </td>
                <td>
                  <div class="actions">
                    <button 
                      class="btn-icon view" 
                      (click)="viewCandidate(candidate)"
                      title="Ø¹Ø±Ø¶">
                      ğŸ‘ï¸
                    </button>
                    <button 
                      class="btn-icon edit" 
                      (click)="editCandidate(candidate)"
                      title="ØªØ¹Ø¯ÙŠÙ„">
                      âœï¸
                    </button>
                    <button 
                      class="btn-icon delete" 
                      (click)="deleteCandidate(candidate)"
                      title="Ø­Ø°Ù">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    }
  </div>
</div>