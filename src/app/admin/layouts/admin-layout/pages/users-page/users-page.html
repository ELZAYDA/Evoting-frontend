<!-- users-page.component.html -->
<div class="users-page">
  <!-- ุฑุฃุณ ุงูุตูุญุฉ -->
  <div class="page-header">
    <div class="header-content">
      <h1>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h1>
      <p class="page-description">ุฅุฏุงุฑุฉ ูุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู ูู ุงููุธุงู</p>
    </div>
  </div>

  <!-- ุฅุญุตุงุฆูุงุช -->
  <div class="stats-grid" *ngIf="stats && !isLoadingStats">
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ stats.totalUsers }}</h3>
        <p>ุฅุฌูุงูู ุงููุณุชุฎุฏููู</p>
      </div>
      <div class="stat-icon">๐ฅ</div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ stats.totalAdmins }}</h3>
        <p>ุงููุฏุฑุงุก</p>
      </div>
      <div class="stat-icon">๐</div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ stats.activeUsersToday }}</h3>
        <p>ูุดุทูู ุงูููู</p>
      </div>
      <div class="stat-icon">๐ข</div>
    </div>
    <div class="stat-card">
      <div class="stat-content">
        <h3>{{ stats.newUsersThisWeek }}</h3>
        <p>ุฌุฏุฏ ูุฐุง ุงูุฃุณุจูุน</p>
      </div>
      <div class="stat-icon">๐</div>
    </div>
  </div>

  <!-- ุฃุฏูุงุช ุงูุจุญุซ ูุงูุชุตููุฉ -->
  <div class="tools-section">
    <div class="search-filters">
      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (keyup.enter)="onSearch()"
          placeholder="ุงุจุญุซ ุจุงูุงุณูุ ุงูุจุฑูุฏุ ุฃู ุงุณู ุงููุณุชุฎุฏู..."
          class="search-input">
        <button (click)="onSearch()" class="btn btn-primary">ุจุญุซ</button>
      </div>
      
      <div class="filters">
        <select 
          [(ngModel)]="roleFilter" 
          (change)="onFilterChange()"
          class="filter-select">
          <option *ngFor="let role of roles" [value]="role.value">
            {{ role.label }}
          </option>
        </select>
      </div>
    </div>
    
    <div class="results-info">
      <span class="results-count">
        ุนุฑุถ {{ users.length }} ูู {{ totalCount }} ูุณุชุฎุฏู
      </span>
    </div>
  </div>

  <!-- ุฑุณุงูุฉ ุงูุฎุทุฃ -->
  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
  </div>

  <!-- ุฌุฏูู ุงููุณุชุฎุฏููู -->
  <div class="table-section">
    @if (isLoading) {
      <div class="loading-state">
        <div class="loading-spinner"></div>
        <p>ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
      </div>
    } @else {
      <div class="table-container">
        @if (users.length === 0) {
          <div class="empty-state">
            <div class="empty-icon">๐ฅ</div>
            <h3>ูุง ุชูุฌุฏ ูุณุชุฎุฏููู</h3>
            <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ูุณุชุฎุฏููู ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ.</p>
          </div>
        } @else {
          <table class="data-table">
            <thead>
              <tr>
                <th>ุงููุณุชุฎุฏู</th>
                <th>ุงูุฏูุฑ</th>
                <th>ุงูุญุงูุฉ</th>
                <th>ุชุงุฑูุฎ ุงูุฅูุดุงุก</th>
                <th>ุขุฎุฑ ุฏุฎูู</th>
                <th>ุงูุฅุฌุฑุงุกุงุช</th>
              </tr>
            </thead>
            <tbody>
              @for (user of users; track user.id) {
                <tr>
                  <td>
                    <div class="user-info">
                      <strong class="user-name">{{ user.fullName }}</strong>
                      <div class="user-details">
                        <span class="user-email">{{ user.email }}</span>
                        <span class="user-username">@{{ user.userName }}</span>
                      </div>
                    </div>
                  </td>
                  <td>
                    <div class="user-roles">
                      <span 
                        *ngFor="let role of user.roles" 
                        [class]="getRoleBadgeClass(role)"
                        class="role-badge">
                        {{ role === 'Admin' ? 'ูุฏูุฑ' : 'ูุณุชุฎุฏู' }}
                      </span>
                    </div>
                  </td>
                  <td>
                    <span [class]="getStatusClass(user.emailConfirmed)" class="status-badge">
                      {{ getStatusText(user.emailConfirmed) }}
                    </span>
                  </td>
                  <td>
                    <span class="date">{{ formatDate(user.createdAt) }}</span>
                  </td>
                  <td>
                    <span class="date">{{ formatDateTime(user.lastLogin) }}</span>
                  </td>
                  <td>
                    <div class="action-buttons">
                      <!-- ุชุบููุฑ ุงูุฏูุฑ -->
                      <div class="dropdown" *ngIf="user.roles[0] !== 'Admin'">
                        <button class="btn-icon btn-role" title="ุชุบููุฑ ุงูุฏูุฑ">
                          ๐
                        </button>
                        <div class="dropdown-content">
                          <button (click)="changeUserRole(user, 'Admin')" class="dropdown-item">
                            ุชุฑููุฉ ุฅูู ูุฏูุฑ
                          </button>
                        </div>
                      </div>

                      <div class="dropdown" *ngIf="user.roles[0] === 'Admin'">
                        <button class="btn-icon btn-role" title="ุชุบููุฑ ุงูุฏูุฑ">
                          ๐
                        </button>
                        <div class="dropdown-content">
                          <button (click)="changeUserRole(user, 'User')" class="dropdown-item">
                            ุฎูุถ ุฅูู ูุณุชุฎุฏู
                          </button>
                        </div>
                      </div>

                      <!-- ุชูุนูู/ุชุนุทูู -->
                      <button 
                        class="btn-icon" 
                        [class.btn-activate]="!user.emailConfirmed"
                        [class.btn-deactivate]="user.emailConfirmed"
                        (click)="toggleUserActive(user)"
                        [title]="user.emailConfirmed ? 'ุชุนุทูู' : 'ุชูุนูู'">
                        {{ user.emailConfirmed ? 'โธ๏ธ' : 'โถ๏ธ' }}
                      </button>

                      <!-- ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ -->
                      <button 
                        class="btn-icon btn-reset-password" 
                        (click)="resetUserPassword(user)"
                        title="ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ">
                        ๐
                      </button>

                      <!-- ุญุฐู -->
                      <button 
                        class="btn-icon btn-delete" 
                        (click)="deleteUser(user)"
                        title="ุญุฐู">
                        ๐๏ธ
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        }
      </div>
    }
  </div>

  <!-- ุงูุชุฑููู -->
  @if (!isLoading && users.length > 0) {
    <div class="pagination">
      <button 
        class="page-btn prev" 
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 1">
        ุงูุณุงุจู
      </button>
      
      <div class="page-numbers">
        <span 
          *ngFor="let page of [].constructor(totalPages); let i = index" 
          class="page-number"
          [class.active]="currentPage === i + 1"
          (click)="onPageChange(i + 1)">
          {{ i + 1 }}
        </span>
      </div>
      
      <button 
        class="page-btn next" 
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage === totalPages">
        ุงูุชุงูู
      </button>
    </div>
  }
</div>